@(message: String, controller : de.htwg.blackjack.controller.IController)

@main("Welcome to Play") {

<link rel="stylesheet" href='@routes.Assets.versioned("stylesheets/main.css")'/>
<link rel="import" href="@routes.Assets.versioned("bower_components/elements/cards-display.html")">
<link rel="import" href="@routes.Assets.versioned("bower_components/elements/player-display.html")">
<link rel="import" href="@routes.Assets.versioned("bower_components/elements/bet-display.html")">

	
	<script language="JavaScript">

	var uri = "ws://localhost:9000/socket";
	var websocket;
	var resetCards = false;
	
		window.onload = getCards();
		
		function getCards() {
			websocket = new WebSocket(uri);
			websocket.onopen = function() { onOpen() }; 
			websocket.onclose = function() { onClose() };
			websocket.onmessage = function(evt) { onMessage(evt) };
			$.get('/socket');
			sendMessage("null");
	 		//$.get('/json',
	 	    	//function(data) {
	 			//	processData(data);
      		//});
		}
	 	    	
		function jsonCommand(command) {
			sendMessage(command);
		//$.post('/json/' + command,
			//function(data) {
			//	processData(data);
      		//});
		}

		function jsonNewPlayer() {
			var name = $("#inputname").val();
			//sendMessage("newplayer:"+name);
			$.post('/newPlayer/' + name,
				function(data) {
					processData(data);	
      		});
		}

		function onOpen() {
			window.alert("CONNECTED");
		}

		function onClose() {
			window.alert("DISCONNECTED");
		}

		function onMessage(evt) {
			window.alert(evt.data);
			processData(evt.data);
		}

		function sendMessage(message) {
			websocket.send(message);
		}

		function processData(data) {
			var json = JSON.parse(data);


    		// Player Cards
          	var cards = json[1].cards;
          	var players = json[0].players[0].length;
          	
          	for (var i = 0; i < players; i++) {
              	if (cards.length > 0) {
					var playerCards = cards[i];
					var amountPlayerCards = playerCards.length;
					for (var j = 0; j < amountPlayerCards; j++) {
						var cardPath = "/assets/images/" + playerCards[j] + ".png";
						$("#pc" + i + "-" + j).attr("src", cardPath);
						resetCards = true;
					}
              	}
              	//if(cards.length == 0) {
                  //	window.alert("ok no cards");
                  	//if(resetCards == true) {
                      //	window.alert("trying to reset cards");
                        //for (var j = 0; j < 6; j++) {
                      // 	$("#pc" + i + "-" j).attr("src","");
                      //}
                      //  window.alert("dont reset cards anymore");
                       // resetCards = false;
                   // }
                //}
          		// Spielername, Kartenwert, Budget
				$("#playername-player" + i).text(json[0].players[0][i]);
				$("#cardvalue-player" + i).text("Wert:   " + json[0].players[1][i]);
				$("#budget-player" + i).text("Budget: " + json[0].players[2][i]);
				// TODO: aktueller Wetteinsatz
          	}
			
			// Dealer Cards
			var dealercards = json[2].dealer[0];
			for (var i = 0; i < dealercards.length; i++) {
				var cardPath = "/assets/images/" + dealercards[i] + ".png";
				$("#dc" + i).attr("src", cardPath);
			}
		
			$("#dealer-cardvalue").text(json[2].dealer[1][0]);

			// Bet Anzeige
			$("#bet-field").text("Bet:    " + json[4].bet[0]);
			$("#total-field").text("Total:  " + json[4].bet[1]);
			// Status
			$("#statusline").text(json[3].statusline);
		}
	</script>
	
		<div class="row">
			<div class="col-md-1">
				<button type="button" class="btn btn-default" onclick="jsonCommand('h')">Hit</button>
			</div>
			<div class="col-md-1">
				<button type="button" class="btn btn-default" onclick="jsonCommand('s')">Stand</button>
			</div>
			<div class="col-md-1">
				<button type="button" class="btn btn-default" onclick="jsonCommand('n')">New Game</button>
			</div>
			<div class="col-md-6"></div>
			<div class="col-md-2">
				<button type="button" class="btn btn-default btn-block "id="bet-field" disabled>Bet </button>
				<button type="button" class="btn btn-default btn-block" id="total-field" disabled>Total</button>
			</div>
			<div class="col-md-1">
				<button type="button" class="btn btn-default btn-block" onclick="jsonCommand('-')">- Bet</button>
				<button type="button" class="btn btn-default btn-block" onclick="jsonCommand('+')">+ Bet</button>
				<button type="button" class="btn btn-default btn-block" onclick="jsonCommand('sb')">Set Bet</button>	
			</div>
			<div class="col-md-1"></div>
		</div>
		<p>&nbsp;</p>
		<div class="row">
			<div class="col-md-12">
				<div id="statusline">placeholder(statusline)
			</div>
		</div>
		
		<p>&nbsp;</p>
		<div class="row">
			<div class="col-md-1">
				<div >Dealer</div>
				<div class="row">
					<div class="col-md-6">
						Wert:
					</div>
					<div class="col-md-6">
						<div id="dealer-cardvalue"></div>
					</div>
				</div>		
			</div>
			<div class="col-md-2">
				<cards-display playeridx="dc"></cards-display>
			</div>		
		</div>
		<p>&nbsp;</p>
		<div class="row">
			<div class="col-md-2">		
				<player-display playeridx="0"></player-display>							
			</div>
			<div class="col-md-2">
				<cards-display playeridx="pc0-"></cards-display>
			</div>
			
			<div class="col-md-2">		
				<player-display playeridx="1"></player-display>							
			</div>
			<div class="col-md-2">
				<cards-display playeridx="pc1-"></cards-display>
			</div>
			
			<div class="col-md-2">		
				<player-display playeridx="2"></player-display>							
			</div>
			<div class="col-md-2">
				<cards-display playeridx="pc2-"></cards-display>
			</div>
		</div>
			
		<p>&nbsp;</p>
		
		<!-- Add new Player -->
		<div class="modal fade" id="addNewPlayer" tabindex="-1" role="dialog" 
		     aria-labelledby="myModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <!-- Modal Header -->
		            <div class="modal-header">
		                <button type="button" class="close" 
		                   data-dismiss="modal">
		                       <span aria-hidden="true">&times;</span>
		                       <span class="sr-only">Close</span>
		                </button>
		                <h4 class="modal-title" id="myModalLabel">
		                    Add new player
		                </h4>
		            </div>
		            
		            <!-- Modal Body -->
		            <div class="modal-body">
		                
		                <form class="form-horizontal" role="form">
		                  <div class="form-group">
		                    <label  class="col-sm-2 control-label"
		                              for="inputname">playername</label>
		                    <div class="col-sm-10">
		                        <input type="text" class="form-control" 
		                        id="inputname"/>
		                    </div>
		                  </div>
		                </form>                
		            </div>
		            
		            <!-- Modal Footer -->
		            <div class="modal-footer">
		                <button type="button" class="btn btn-default"
		                        data-dismiss="modal">
		                            Cancel
		                </button>
		                <button type="button" class="btn btn-primary" onClick="jsonNewPlayer()" data-dismiss="modal">
		                    Add Player
		                </button>
		            </div>
		        </div>
		    </div>
		</div>
	</div>
    
		
}